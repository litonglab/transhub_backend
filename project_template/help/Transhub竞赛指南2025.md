# 2025 è®¡ç®—æœºç½‘ç»œæ ¡å†…èµ›

æœ¬æ¬¡ç«èµ›æœ€ç»ˆç»“æœéœ€è¦æäº¤åœ¨æœ¬ç½‘ç«™ â€œç®—æ³•æäº¤â€ å¤„å¹¶æŸ¥çœ‹æ’åã€‚ä½†ä¸ºäº†æ–¹ä¾¿å‚èµ›è€…ä¿®æ”¹å’Œè°ƒè¯•è‡ªå·±çš„æ‹¥å¡æ§åˆ¶ç®—æ³•ä»£ç ï¼Œéœ€è¦å„ä½åœ¨æœ¬åœ°é…ç½®
Transhub è¿è¡Œç¯å¢ƒï¼Œå¯é˜…è¯»æœ¬æ–‡â€œTranshub ä»£ç æ¡†æ¶â€å’Œ â€œå®‰è£…æŒ‡å—â€ éƒ¨åˆ†ã€‚

æœ¬æ¬¡æ¯”èµ›è®¾ç½®ä¸€äºŒä¸‰ç­‰å¥–åŠä¼˜èƒœå¥–ï¼Œå¹¶è®¾ç«‹å¥–é‡‘ï¼Œæ¬¢è¿åŒå­¦ä»¬ç§¯æå‚ä¸ï¼

**èµ›äº‹ç®€ä»‹ï¼š**
è®¡ç®—æœºç½‘ç»œèµ›é“æ—¨åœ¨è€ƒå¯Ÿå‚èµ›è€…å¯¹è®¡ç®—æœºç½‘ç»œåè®®ç‰¹åˆ«æ˜¯æ‹¥å¡æ§åˆ¶ç®—æ³•çš„ç†è§£ç¨‹åº¦ï¼Œè®©åŒå­¦ä»¬èƒ½å¤Ÿæ›´æ·±å…¥åœ°äº†è§£å’ŒæŒæ¡è®¡ç®—æœºç½‘ç»œåè®®çš„åŸç†å’Œå®ç°ï¼Œæå‡ç½‘ç»œç¼–ç¨‹èƒ½åŠ›ï¼Œä¸ºä¸Šå±‚å¤§æ•°æ®ã€äººå·¥æ™ºèƒ½ã€åˆ†å¸ƒå¼ç³»ç»Ÿç­‰ç›¸å…³åº”ç”¨çš„å¼€å‘æ‰“ä¸‹åšå®çš„åŸºç¡€ã€‚
æœ¬æ¬¡ç«èµ›ä¸ºä¸ªäººèµ›ï¼Œå°†æä¾›ä¸€ä¸ªç”¨æˆ·æ€åè®®æ¡†æ¶Transhubï¼ˆå¼€æ”¾æºç ï¼Œå¯æœ¬åœ°éƒ¨ç½²å’Œè°ƒè¯•ï¼‰ï¼Œè¯¥æ¡†æ¶åŸºäºUDPåè®®è¿›è¡Œå®ç°ï¼Œæä¾›ä¼ è¾“åè®®åŸºæœ¬çš„åŠŸèƒ½æ¨¡å—ï¼Œå¦‚åºå·ã€åŒ…ç±»å‹ã€ç¡®è®¤æœºåˆ¶ç­‰ï¼Œå¹¶æä¾›å¦‚å‘é€ã€æ¥æ”¶ç­‰é¢„åˆ¶çš„æ¥å£APIã€‚å‚èµ›è€…éœ€è¦åœ¨è¯¥æ¡†æ¶ä¸Šï¼Œä»¥â€œå®Œå½¢å¡«ç©ºâ€çš„å½¢å¼å®ç°ä¸€ä¸ªæ‹¥å¡æ§åˆ¶ç®—æ³•ã€‚æ¯”èµ›å½¢å¼ä¸ºæ’è¡Œæ¦œå½¢å¼ï¼Œå‚èµ›è€…å°†è‡ªå·±çš„ç®—æ³•æºç ä¸Šä¼ è‡³çº¿ä¸ŠTranshubå¹³å°ã€‚çº¿ä¸ŠTranshubå¹³å°æä¾›ç»Ÿä¸€çš„benchmarkå¯¹å‚èµ›è€…çš„ç®—æ³•è¿›è¡Œæµ‹è¯•ã€‚å…·ä½“åœ°ï¼Œé€šè¿‡æ¨¡æ‹Ÿä¸åŒçš„ç½‘ç»œç¯å¢ƒï¼Œé’ˆå¯¹æ—¶å»¶ã€ååå’Œä¸¢åŒ…ä¸‰ä¸ªæŒ‡æ ‡ï¼Œå¯¹å‚èµ›è€…æä¾›çš„æ‹¥å¡æ§åˆ¶ç®—æ³•è¿›è¡Œè¯„ä¼°ï¼Œå¹¶æ‰“å‡ºç»¼åˆè¯„åˆ†ï¼Œè¯„åˆ†è¶Šé«˜ï¼Œæœ€ç»ˆæ’åè¶Šé å‰ã€‚åœ¨æ‰“æ¦œå¼€æ”¾ä¹‹æ—¥èµ·ï¼Œå‚èµ›è€…å¯éšæ—¶ä¸é™æ¬¡æ•°åœ°ä¸Šä¼ è‡ªå·±çš„ç®—æ³•ï¼Œæ¦œå•å°†æ›´æ–°å‚èµ›è€…çš„å†å²æœ€é«˜æˆç»©ã€‚æ¯”èµ›ç»“æŸåï¼Œå°†å¯¹æ¦œå•æˆç»©è¿›è¡Œå¤æ ¸ï¼Œå¹¶æŒ‰ç…§æœ€ç»ˆå¤æ ¸æ’åå†³å‡ºç›¸åº”å¥–é¡¹ï¼ˆä¼˜èƒœå¥–ç»¼åˆè€ƒè™‘æ’åå’Œç®—æ³•è®¾è®¡ï¼‰ã€‚



## 1. è¯„åˆ†æ ‡å‡†

### 1.1 æŒ‡æ ‡å®šä¹‰ä¸æ•°æ®æ¥æº

| æŒ‡æ ‡åç§°             | å˜é‡å                 | æè¿°                         |
| -------------------- | ---------------------- | ---------------------------- |
| ååé‡               | `throughput`           | å¹³å‡ååé‡                   |
| é“¾è·¯å¸¦å®½             | `capacity`             | å¹³å‡é“¾è·¯å¸¦å®½                 |
| å¸¦å®½åˆ©ç”¨ç‡           | `capacity_utilization` | ååé‡ä¸é“¾è·¯å¸¦å®½çš„æ¯”å€¼       |
| ä¸‹è¡Œé“¾è·¯æ’é˜Ÿå»¶è¿Ÿ     | `queueing_delay`       | æ‰€æœ‰æ•°æ®åŒ…æ’é˜Ÿå»¶è¿Ÿçš„95åˆ†ä½ç‚¹ |
| ä¸‹è¡Œé“¾è·¯åŸºç¡€å•å‘å»¶è¿Ÿ | `one-way_delay`        | æ²¡æœ‰æ’é˜Ÿå»¶è¿Ÿæ—¶çš„é“¾è·¯å•å‘å»¶è¿Ÿ |
| å»¶è¿Ÿè†¨èƒ€ç‡           | `delay_inflation`      | æ’é˜Ÿå»¶è¿Ÿä¸åŸºç¡€å•å‘å»¶è¿Ÿçš„æ¯”å€¼ |
| æ€»ä¸¢åŒ…æ•°             | `total_lost`           | ä¸¢å¤±çš„æ•°æ®åŒ…æ€»é‡             |
| æ€»å‘åŒ…æ•°             | `total_sent`           | å‘é€çš„æ•°æ®åŒ…æ€»é‡             |
| ä¸¢åŒ…ç‡               | `loss_rate`            | æ€»ä¸¢åŒ…æ•°ä¸æ€»å‘åŒ…æ•°çš„æ¯”å€¼     |

### 1.2 è¯„åˆ†ç»´åº¦ä¸æƒé‡

| è¯„åˆ†ç»´åº¦åç§°     | å˜é‡å             | æƒé‡ | è¯„åˆ†èŒƒå›´ |
| ---------------- | ------------------ | ---- | -------- |
| **å¸¦å®½åˆ©ç”¨å¾—åˆ†** | `throughput_score` | 35%  | 0-100    |
| **å»¶è¿Ÿæ§åˆ¶å¾—åˆ†** | `delay_score`      | 35%  | 0-100    |
| **ä¸¢åŒ…æ§åˆ¶å¾—åˆ†** | `loss_score`       | 30%  | 0-100    |
| **æ€»å¾—åˆ†**       | `total_score`      | 100% | 0-100    |

### 1.3 è¯¦ç»†è¯„åˆ†è§„åˆ™

#### 1.3.1. å¸¦å®½åˆ©ç”¨å¾—åˆ† (35%)

$$
\text{capacity\_utilization} = \frac{\text{throughput}}{\text{capacity}}
$$

$$
\text{throughput\_score} = 100 \times \text{capacity\_utilization}
$$

#### 1.3.2. å»¶è¿Ÿæ§åˆ¶å¾—åˆ† (35%)

$$
\text{delay\_inflation} = \frac{\text{queueing\_delay}}{\text{one-way\_delay}}
$$

$$
\text{delay\_score} =
\begin{cases}
20 + 80 \times \dfrac{10 - \text{delay\_inflation}}{10} & \text{if } \text{delay\_inflation} \leq 10 \\\\
\dfrac{200}{\text{delay\_inflation}} & \text{if } \text{delay\_inflation} > 10
\end{cases}
$$

#### 1.3.3. ä¸¢åŒ…æ§åˆ¶å¾—åˆ† (30%)

$$
\text{loss\_rate} = \frac{\text{total\_lost}}{\text{total\_sent}}
$$

$$
\text{loss\_score} = 100 \times (1 - \text{loss\_rate})
$$

#### 1.3.4. æ€»å¾—åˆ†

$$
\text{total\_score} = 0.35 \times \text{throughput\_score} + 0.35 \times \text{delay\_score} + 0.30 \times \text{loss\_score}
$$



## 2. æµ‹è¯•ç”¨ä¾‹

æœ¬æ¬¡æ¯”èµ›æ€»å…±åŒ…å«10ç±»æµ‹è¯•ç”¨ä¾‹ï¼Œä»¥è¯„ä»·ä¸åŒåœºæ™¯ä¸‹çš„ç®—æ³•æ€§èƒ½ï¼Œä»¥ä¸‹æ˜¯æµ‹è¯•ç”¨ä¾‹ä»‹ç»ï¼š

| æµ‹è¯•ç”¨ä¾‹           | ç‰¹ç‚¹                                                         | ç®—æ³•ç›®æ ‡                                                     | çœŸå®åœºæ™¯                                                     |
| :----------------- | :----------------------------------------------------------- | :----------------------------------------------------------- | :----------------------------------------------------------- |
| ç§»åŠ¨ç½‘ç»œ1ï¼ˆå…¬å¼€ï¼‰  | å¸¦å®½åŠ¨æ€ä¸”é¢‘ç¹åœ°æ³¢åŠ¨ã€‚                                       | å¿«é€Ÿã€å‡†ç¡®åœ°æµ‹é‡å®æ—¶å¸¦å®½ï¼Œåœ¨ä¿è¯ä½æ—¶å»¶å’Œä½ä¸¢åŒ…ç‡çš„åŒæ—¶ï¼Œæœ€å¤§åŒ–ååé‡ã€‚ | ç”¨æˆ·åœ¨å…¬äº¤ã€åœ°é“ã€æ±½è½¦ç­‰ç§»åŠ¨äº¤é€šå·¥å…·ä¸Šä½¿ç”¨ç½‘ç»œï¼Œä¿¡å·å¼ºåº¦å’Œç½‘ç»œè´Ÿè½½ä¸æ–­å˜åŒ–ã€‚ |
| å¼ºå¼±ç½‘åˆ‡æ¢ï¼ˆå…¬å¼€ï¼‰ | å¸¦å®½åœ¨çŸ­æ—¶é—´å†…ä»é«˜å¸¦å®½ï¼ˆå¼ºç½‘ï¼‰çªé™è‡³ä½å¸¦å®½ï¼ˆå¼±ç½‘ï¼‰ï¼Œæˆ–åä¹‹ã€‚ | å¿«é€Ÿå“åº”å¸¦å®½å‰§å˜ï¼Œåœ¨åˆ‡æ¢åˆ°å¼±ç½‘æ—¶èƒ½è¿…é€Ÿé™ä½å‘é€é€Ÿç‡ä»¥é¿å…æ‹¥å¡ï¼Œåœ¨åˆ‡æ¢åˆ°å¼ºç½‘æ—¶èƒ½å¿«é€Ÿæå‡é€Ÿç‡ä»¥åˆ©ç”¨å¯ç”¨å¸¦å®½ã€‚ | ç”¨æˆ·ä»å®¤å†…Wi-Fiç¯å¢ƒèµ°åˆ°å®¤å¤–ä½¿ç”¨4G/5Gç½‘ç»œï¼Œæˆ–è¿›å…¥/ç¦»å¼€ç”µæ¢¯ã€éš§é“ç­‰ä¿¡å·å±è”½åŒºåŸŸã€‚ |
| ç§»åŠ¨ç½‘ç»œ2          | å¸¦å®½åŠ¨æ€ä¸”é¢‘ç¹åœ°æ³¢åŠ¨ã€‚                                       | å¿«é€Ÿã€å‡†ç¡®åœ°æµ‹é‡å®æ—¶å¸¦å®½ï¼Œåœ¨ä¿è¯ä½æ—¶å»¶å’Œä½ä¸¢åŒ…ç‡çš„åŒæ—¶ï¼Œæœ€å¤§åŒ–ååé‡ã€‚ | ç”¨æˆ·åœ¨å…¬äº¤ã€åœ°é“ã€æ±½è½¦ç­‰ç§»åŠ¨äº¤é€šå·¥å…·ä¸Šä½¿ç”¨ç½‘ç»œï¼Œä¿¡å·å¼ºåº¦å’Œç½‘ç»œè´Ÿè½½ä¸æ–­å˜åŒ–ã€‚ |
| å¸¦å®½çªå˜           | ç½‘ç»œå¯ç”¨å¸¦å®½å‘ç”Ÿéè¿ç»­çš„å¤§å¹…åº¦å¢åŠ æˆ–å‡å°‘ã€‚                   | èƒ½å¤Ÿé€‚åº”è¾ƒå¤§çš„å¸¦å®½å˜åŒ–èŒƒå›´ï¼Œå…·æœ‰è‰¯å¥½çš„ä¸Šæ¢å’Œæ”¶æ•›æ€§èƒ½ï¼Œé¿å…åœ¨å¸¦å®½ä¸‹é™æ—¶äº§ç”Ÿå¤§é‡ä¸¢åŒ…ï¼Œåœ¨å¸¦å®½ä¸Šå‡æ—¶èƒ½å¿«é€Ÿè·Ÿè¿›ã€‚ | åœ¨å…±äº«ç½‘ç»œï¼ˆå¦‚åŠå…¬å®¤ã€å®¶åº­Wi-Fiï¼‰ä¸­ï¼Œå…¶ä»–ç”¨æˆ·å¼€å¯æˆ–åœæ­¢å¤§æµé‡ä»»åŠ¡ï¼ˆå¦‚ä¸‹è½½ã€è§†é¢‘æµï¼‰ã€‚ |
| é•¿è‚¥ç½‘ç»œ (LFN)     | å…·æœ‰éå¸¸å¤§çš„å¸¦å®½æ—¶å»¶ç§¯ï¼ˆBDPï¼‰ï¼Œå³é«˜å¸¦å®½å’Œé«˜å¾€è¿”æ—¶å»¶ï¼ˆRTTï¼‰å¹¶å­˜ã€‚ | èƒ½å¤Ÿå¿«é€Ÿå°†å‘é€çª—å£æå‡è‡³BDPå¤§å°ï¼Œå……åˆ†åˆ©ç”¨é“¾è·¯å®¹é‡ï¼Œå®ç°é«˜å¸¦å®½åˆ©ç”¨ç‡ï¼ŒåŒæ—¶é¿å…å› çª—å£è¿‡å¤§å¯¼è‡´æ‹¥å¡ã€‚ | è·¨å›½æˆ–è·¨æ´²é™…çš„æ•°æ®ä¼ è¾“ã€å«æ˜Ÿé€šä¿¡ç­‰åœºæ™¯ã€‚                     |
| ä½æ—¶å»¶ç½‘ç»œ         | å¾€è¿”æ—¶å»¶ï¼ˆRTTï¼‰éå¸¸ä½ï¼Œé€šå¸¸å°äº30msã€‚                        | ç»´æŒæä½çš„æ’é˜Ÿå»¶è¿Ÿï¼Œå¯¹å»¶è¿Ÿå˜åŒ–æå…¶æ•æ„Ÿï¼Œé¿å…ä¸å¿…è¦çš„é€Ÿç‡æ³¢åŠ¨ï¼Œä¿è¯äº¤äº’çš„å®æ—¶æ€§ã€‚ | æ•°æ®ä¸­å¿ƒå†…éƒ¨é€šä¿¡ã€å±€åŸŸç½‘å†…çš„å®æ—¶æ¸¸æˆã€è¿œç¨‹æ¡Œé¢ç­‰ã€‚           |
| é«˜æ—¶å»¶ç½‘ç»œ         | å¾€è¿”æ—¶å»¶ï¼ˆRTTï¼‰éå¸¸é«˜ï¼Œé€šå¸¸å¤§äº200msã€‚                       | åœ¨é«˜å»¶è¿Ÿåé¦ˆä¸‹ä¿æŒç¨³å®šï¼Œé¿å…å› åé¦ˆæ»åè€Œå¯¼è‡´çš„å‘é€é€Ÿç‡å‰§çƒˆéœ‡è¡å’Œæ‹¥å¡å´©æºƒã€‚ | å«æ˜Ÿç½‘ç»œé€šä¿¡ã€å›½é™…é•¿é€”è§†é¢‘ä¼šè®®ã€åœ¨åœ°ç†ä½ç½®åè¿œçš„åœ°åŒºè®¿é—®ä¸­å¿ƒæœåŠ¡å™¨ã€‚ |
| éšæœºä¸¢åŒ…           | é“¾è·¯ä¸­å­˜åœ¨ä¸å› æ‹¥å¡å¯¼è‡´çš„éšæœºæ•°æ®åŒ…ä¸¢å¤±ã€‚                     | å‡†ç¡®åŒºåˆ†æ‹¥å¡ä¸¢åŒ…å’Œéšæœºä¸¢åŒ…ï¼Œé¿å…å› éšæœºä¸¢åŒ…è€Œé”™è¯¯åœ°å¤§å¹…é™ä½å‘é€é€Ÿç‡ï¼Œç»´æŒç¨³å®šçš„ååã€‚ | æ— çº¿ä¿¡é“ï¼ˆWi-Fi, 4G/5Gï¼‰å—åˆ°å¹²æ‰°ã€æœ‰çº¿é“¾è·¯è´¨é‡å·®ç­‰æƒ…å†µï¼›è·¨çœç­‰åœºæ™¯ä¸‹ç”±äºè¿è¥å•†ç­–ç•¥å¯¼è‡´çš„éšæœºä¸¢åŒ…ã€‚ |
| æµ…ç¼“å†²åŒº           | ç½‘ç»œè·¯å¾„ä¸­çš„è·¯ç”±å™¨æˆ–äº¤æ¢æœºç¼“å†²åŒºï¼ˆBufferï¼‰éå¸¸å°ã€‚           | ç²¾ç¡®æ§åˆ¶æ•°æ®å‘é€é‡ï¼Œé¿å…ç¬é—´æµé‡è¶…å‡ºç¼“å†²åŒºå®¹é‡å¯¼è‡´å¤§é‡ä¸¢åŒ…ï¼Œå¯¹æ’é˜Ÿå»¶è¿Ÿçš„å¢é•¿åšå‡ºå¿«é€Ÿååº”ã€‚ | ä¸€äº›ä½æˆæœ¬çš„å®¶ç”¨è·¯ç”±å™¨æˆ–ç‰¹å®šç½‘ç»œè®¾å¤‡ï¼Œä¸ºäº†é™ä½æˆæœ¬å’Œå»¶è¿Ÿè€Œé…ç½®äº†è¾ƒå°çš„ç¼“å†²åŒºã€‚ |
| æ·±ç¼“å†²åŒº           | ç½‘ç»œè·¯å¾„ä¸­çš„è·¯ç”±å™¨æˆ–äº¤æ¢æœºç¼“å†²åŒºéå¸¸å¤§ã€‚                     | é¿å…è¿‡åº¦å¡«å……ç¼“å†²åŒºå¯¼è‡´çš„é«˜æ’é˜Ÿå»¶è¿Ÿï¼ˆBufferbloatï¼‰ï¼Œåœ¨ç»´æŒé«˜ååçš„åŒæ—¶ï¼Œå°†ç½‘ç»œå»¶è¿Ÿæ§åˆ¶åœ¨è¾ƒä½æ°´å¹³ã€‚ | è®¸å¤šç°ä»£ç½‘ç»œè®¾å¤‡ä¸ºäº†é˜²æ­¢çªå‘æµé‡ä¸‹çš„ä¸¢åŒ…è€Œé…ç½®äº†è¿‡å¤§çš„ç¼“å†²åŒºï¼Œå®¹æ˜“å¼•å‘å»¶è¿Ÿå‰§å¢é—®é¢˜ã€‚ |

**æ³¨ï¼šä¸Šè¿°è¡¨æ ¼é¡ºåºä¸ä»»åŠ¡è¯¦æƒ…é¡µé¢æ˜¾ç¤ºçš„è¯„æµ‹ç”¨ä¾‹é¡ºåºå¹¶éä¸€ä¸€å¯¹åº”å…³ç³»ã€‚*



## 3. æˆç»©å¤æ ¸åŠæ³•

æ¯”èµ›ç»“æŸåï¼Œå°†å¯¹æ¦œå•ä¸­çš„ä»£ç è¿›è¡Œå¤æµ‹åŠäººå·¥å¤æ ¸ã€‚

äººå·¥å¤æ ¸ï¼šæ£€æŸ¥ä»£ç æ˜¯å¦å­˜åœ¨æŠ„è¢­ç­‰é—®é¢˜ï¼Œå­˜åœ¨é—®é¢˜çš„ä»£ç æˆç»©æ— æ•ˆã€‚å¯¹äºç®—æ³•ä¸­å­˜åœ¨æ ¹æ®è¯„æµ‹ç”¨ä¾‹é‡‡ç”¨ç±»ä¼¼â€œæ‰“è¡¨â€çš„ä»£ç ï¼ˆä¾‹å¦‚ä»¥ä¸‹ä¼ªä»£ç ç¤ºä¾‹ï¼‰ï¼Œå°†å¯¹å¥–é¡¹è¿›è¡Œé™ç­‰å¤„ç†ï¼ˆä¾‹å¦‚ï¼šä¸€ç­‰å¥–->äºŒç­‰å¥–ï¼Œä¸‰ç­‰å¥–->ä¼˜èƒœå¥–ï¼‰ã€‚

```c
// å…¬å¼€æµ‹è¯•ç”¨ä¾‹
if (time < 18s)
  bandwidth = 35mbps;
else if (time < 38s)
  bandwidth = 12mbps;
else
  bandwidth = 35mbps;

window_size = f(bandwidth);
```

ç³»ç»Ÿå¤æµ‹ï¼šå¯¹æ¯ä»½ä»£ç æäº¤ä¸‰æ¬¡ã€‚å¤æµ‹æ—¶ï¼Œå°†è¯„æµ‹ä»»åŠ¡å¹¶å‘æ•°è®¾ç½®ä¸º1ï¼Œå¹¶å…³é—­æ€§èƒ½å›¾ç»˜åˆ¶åŠŸèƒ½ï¼Œé¿å…è¯„æµ‹é—´ç›¸äº’å¹²æ‰°ã€‚

æœ€ç»ˆæˆç»©ï¼šæ ¹æ®ç³»ç»Ÿå¤æµ‹ç»“æœï¼Œå–ä¸‰æ¬¡å¤æµ‹çš„å¹³å‡åˆ†ä½œä¸ºæœ€ç»ˆæˆç»©ã€‚å¤æµ‹è¿‡ç¨‹ä¸­ï¼Œå¦‚å› ç³»ç»ŸåŸå› å¯¼è‡´æˆç»©å¼‚å¸¸çš„ï¼Œå°†å†æ¬¡æäº¤ï¼Œä¸å½±å“åˆ†æ•°ï¼›å¦‚æ˜¯ç®—æ³•è®¾è®¡ç¼ºé™·å¯¼è‡´çš„åˆ†æ•°å¼‚å¸¸ï¼ˆä¾‹å¦‚ï¼šéƒ¨åˆ†ä»£ç åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­æœ‰æ¦‚ç‡å‡ºç°ä»¥ä¸‹å¦‚å›¾æ‰€ç¤ºé—®é¢˜ï¼Œæ­¤é—®é¢˜å±äºç®—æ³•ç¼ºé™·ï¼‰ï¼Œä¹Ÿå°†å†æ¬¡æäº¤ï¼Œä½†å¯¹åº”å¤æµ‹åˆ†æ•°-5åˆ†ã€‚

![bug_example](./images/bug_example.png)



## 4. è¯„å¥–æ ‡å‡†

- ä¸€äºŒä¸‰ç­‰å¥–ï¼šæŒ‰ç…§å¤æµ‹åçš„æ’åé¡ºåºï¼Œåˆ†é…å¥–é¡¹ã€‚
- ä¼˜èƒœå¥–ï¼šç»¼åˆè€ƒè™‘æ’åå’Œç®—æ³•è®¾è®¡ï¼Œå› æ­¤å»ºè®®åœ¨ä»£ç ä¸­ä½¿ç”¨æ³¨é‡Šä»‹ç»è‡ªå·±çš„ç®—æ³•è®¾è®¡æ€æƒ³ã€äº®ç‚¹ç­‰ã€‚



# Transhub æ¡†æ¶ä»‹ç»

å°† Transhub ä»£ç å…‹éš†åˆ°æœ¬åœ°åï¼Œå¤§å®¶éœ€è¦å…³å¿ƒ `/cc-training/datagrump` ç›®å½•ä¸‹çš„å†…å®¹ï¼Œè¯¥ç›®å½•ä¸‹çš„å†…å®¹ä¸æ¯”èµ›æ¯æ¯ç›¸å…³ï¼Œä»¥ä¸‹æ˜¯å¯¹
`datagrump` ç›®å½•ä¸‹å„æ–‡ä»¶çš„ç®€å•ä»‹ç»ã€‚

- **contest_message æ–‡ä»¶**ï¼šè§„å®šæ•°æ®æŠ¥æ–‡çš„æ ¼å¼ã€‚

  åœ¨é€šä¿¡ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº‹å…ˆåœ¨é€šä¿¡åŒæ–¹çº¦å®šä¸€ä¸ªé€šä¿¡è¯­æ³•ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”ç€ä¸€ä¸ªæŠ¥æ–‡æ ¼å¼æ ‡å‡†ï¼Œç”¨æ¥æŒ‡å®šä¼ è¾“è¿‡ç¨‹ä¸­æ•°æ®çš„ç»„ç»‡å½¢å¼ã€‚æŠ¥æ–‡æ ¼å¼æ ‡å‡†æ²¡æœ‰å›ºå®šçš„è¦æ±‚ï¼Œå”¯ä¸€çš„è¦æ±‚å°±æ˜¯å‘é€ç«¯å’Œæ¥æ”¶ç«¯éƒ½æ¥å—ç›¸åŒçš„æ ‡å‡†ã€‚

  æ•°æ®æŠ¥æ–‡ï¼ˆPacketï¼‰æ€»ä½“æ¥è¯´åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šæŠ¥æ–‡å¤´éƒ¨å’ŒåŒ…å†…æ•°æ®ã€‚æŠ¥æ–‡å¤´éƒ¨ä¸»è¦åŒ…å«æè¿°æŠ¥æ–‡ç‰¹æ€§çš„ä¸€äº›å…ƒæ•°æ®ï¼Œä¾‹å¦‚æŠ¥æ–‡åºåˆ—å·ã€æŠ¥æ–‡çš„å‘é€æ—¶é—´ç­‰ç­‰ã€‚æ¯”èµ›æµ‹è¯•åœºæ™¯æ˜¯å›ºå®šå‘é€ç«¯å’Œæ¥æ”¶ç«¯ï¼Œå› æ­¤æŠ¥æ–‡å¤´å…ƒæ•°æ®éƒ¨åˆ†æ›´åŠ ç®€å•ï¼Œå…·ä½“æœ‰ä»¥ä¸‹ä¸€äº›å­—æ®µï¼š

  `sequence_number`ï¼šæ•°æ®æŠ¥æ–‡çš„åºåˆ—å·

  `send_timestamp`ï¼šæ•°æ®æŠ¥æ–‡çš„å‘é€æ—¶é—´

  `ack_sequence_number`ï¼šç¡®è®¤æ”¶åˆ°çš„æ•°æ®æŠ¥æ–‡åºåˆ—å·

  `ack_send_timestamp`ï¼šç¡®è®¤æŠ¥æ–‡ï¼ˆACKï¼‰çš„å‘é€æ—¶é—´

  `ack_recv_timestamp`ï¼šç¡®è®¤æŠ¥æ–‡ï¼ˆACKï¼‰çš„æ¥æ”¶æ—¶é—´

  `ack_payload_length`ï¼šæ•°æ®æŠ¥æ–‡çš„æœ‰æ•ˆè½½è·å¤§å°

- **sender.cc æ–‡ä»¶**ï¼šæ¨¡æ‹Ÿå‘é€ç«¯çš„è¡Œä¸ºã€‚

  å‘é€ç«¯çš„è¡Œä¸ºéµå¾ªä¸¤ä¸ªå‡†åˆ™ï¼Œä¸€æ˜¯å¦‚æœå‘é€ç«¯è¿˜æœ‰å‘é€çª—å£ç©ºä½™ï¼Œå‘é€ç«¯å°±å‘é€æ›´å¤šçš„æ•°æ®æŠ¥æ–‡æ¥å¡«æ»¡å‘é€çª—å£ï¼›äºŒæ˜¯å¦‚æœå‘é€ç«¯æ”¶åˆ°äº†
  ACKï¼Œå¤„ç†è¯¥ç¡®è®¤æŠ¥æ–‡å¹¶é€šçŸ¥ `controller`ï¼Œè¿›è¡Œæ‹¥å¡æ§åˆ¶ã€‚æ­¤å¤–ï¼Œå¦‚æœè¶…è¿‡äº†ä¸€å®šçš„æ—¶é—´ï¼ˆè¶…æ—¶æ—¶é—´ï¼‰å‘é€ç«¯è¿˜æ²¡æ”¶åˆ°
  ACKï¼Œå‘é€ç«¯ä¼šè®¤ä¸ºè¿™ä¸ªæŠ¥æ–‡ä¸¢å¤±äº†ï¼Œä¼šè¿›è¡Œé‡ä¼ ã€‚å…·ä½“ç»†èŠ‚è¯·å‚çœ‹ `sender.cc` æ–‡ä»¶ã€‚

- **receiver.cc æ–‡ä»¶**ï¼šæ¨¡æ‹Ÿæ¥æ”¶ç«¯çš„è¡Œä¸ºã€‚

  æ¥æ”¶ç«¯ä¼šä¸ºæ”¶åˆ°çš„æ¯ä¸ªæ•°æ®æŠ¥æ–‡å‘é€ ACKï¼Œ`ack_sequence_number` å°±æ˜¯æ•°æ®æŠ¥æ–‡çš„åºåˆ—å· `sequence_number`ï¼Œå…·ä½“ç»†èŠ‚è¯·å‚çœ‹
  `receiver.cc` æ–‡ä»¶å’Œ `contest_message.cc` æ–‡ä»¶ä¸­çš„ `transform_into_ack` å‡½æ•°ã€‚

- **controller.cc æ–‡ä»¶**ï¼šæ¨¡æ‹Ÿè¿›è¡Œæ‹¥å¡æ§åˆ¶çš„æ–‡ä»¶ï¼Œä¹Ÿæ˜¯å‚èµ›è€…ä»¬éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶ã€‚ æœ‰ä»¥ä¸‹å››ä¸ªæ¥å£å‡½æ•°ï¼š

  `window_size()`ï¼šè¿”å›ç»™å‘é€ç«¯å½“å‰çš„å‘é€çª—å£å¤§å°ã€‚

  `datagram_was_sent()`ï¼šå‘é€ç«¯å‘é€æ•°æ®æŠ¥æ–‡æ—¶è°ƒç”¨ controller ä¸­çš„è¯¥å‡½æ•°ï¼Œå‚æ•°ä¸­æœ‰ `const bool after_timeout`
  æ ‡å¿—ä½ï¼Œæ ‡è®°è¯¥æŠ¥æ–‡æ˜¯å¦æ˜¯å› ä¸ºè¶…æ—¶å‘é€çš„ã€‚

  `ack_received()`ï¼šå‘é€ç«¯æ”¶åˆ° ACK æ—¶ä¼šè°ƒç”¨ controller ä¸­çš„è¯¥å‡½æ•°ï¼Œæ ¹æ® ACK æŠ¥æ–‡ä¸­çš„ä¿¡æ¯ï¼Œå¦‚ç¡®è®¤åºåˆ—å·ã€æ•°æ®æŠ¥æ–‡çš„å‘é€æ—¶é—´æˆ³ã€ACK
  çš„æ¥æ”¶æ—¶é—´æˆ³ç­‰ä¿¡æ¯ï¼Œè®¡ç®—å¾€è¿”æ—¶å»¶ç­‰å˜é‡ï¼Œè¿›è¡Œæ‹¥å¡æ§åˆ¶ã€‚

  `timeout_ms()`ï¼šè®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œè¿”å›ç»™å‘é€ç«¯ã€‚

- **run-contest æ–‡ä»¶**ï¼šæµ‹è¯•è„šæœ¬ã€‚



# Transhub å®‰è£…æŒ‡å— 2025 ç‰ˆ

ç¡¬ä»¶ç¯å¢ƒï¼šä¸€å° Linux ä¸»æœºï¼ˆåœ¨æœ¬æ–‡ä¸­ï¼ŒLinux ä¸»æœºåŒ…æ‹¬è¿è¡Œ Linux ç³»ç»Ÿçš„å®ä½“æœºã€è™šæ‹Ÿæœºæˆ–äº‘æœåŠ¡å™¨ï¼‰

Linux ç‰ˆæœ¬è¦æ±‚ï¼šUbuntu GNU/Linux 14.04 ä»¥ä¸Š

**æ‹¥å¡æ§åˆ¶ç®—æ³•çš„è¿è¡Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š**

![transhub_framework](./images/transhub_framework.svg)

æœ¬æ•™ç¨‹æä¾›ä¸¤ç§å®‰è£…æ–¹å¼ï¼Œä¸¤ç§æ–¹å¼**ä»»é€‰å…¶ä¸€**ï¼š

- ç¬¬ä¸€ç§æ–¹æ³•ä¸ºä½¿ç”¨ Linux è™šæ‹Ÿæœº/ä¸»æœºï¼Œå®‰è£…ç›¸å…³ä¾èµ–ï¼Œä¸‹è½½ transhub ä»£ç å¹¶ç¼–è¯‘ï¼Œç¼–è¯‘å®Œæˆåå³å¯è¿è¡Œå®éªŒã€‚
- ç¬¬äºŒç§æ–¹æ³•ä¸ºä½¿ç”¨å·²é…ç½®å¥½çš„ Docker é•œåƒï¼Œé•œåƒé‡Œå·²è£…å¥½ç›¸å…³ä¾èµ–å’Œä»£ç ï¼Œ**å¼€ç®±å³ç”¨**ï¼Œå¯**ç›´æ¥**è¿è¡Œå®éªŒã€‚

â— ç”±äºä»¥ä¸Šéƒ¨åˆ†ä¾èµ–ä»…æœ‰ x86 æ¶æ„çš„åŒ…ï¼Œå› æ­¤ä½¿ç”¨**Mac M èŠ¯ç‰‡**çš„åŒå­¦éœ€è¦æ³¨æ„ï¼Œå¦‚æœä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•è‡ªè¡Œå®‰è£…è™šæ‹Ÿæœºï¼Œéœ€å®‰è£…
x86 æ¶æ„çš„ Linux ç³»ç»Ÿï¼Œä½¿ç”¨ Arm æ¶æ„çš„è™šæ‹Ÿæœºå°†æ— æ³•å®‰è£…æ‰€æœ‰ä¾èµ–ã€‚å»ºè®® Mac M èŠ¯ç‰‡åŒå­¦ä½¿ç”¨**Docker æ–¹æ³•**ã€‚

â— é«˜ç‰ˆæœ¬ Ubuntuã€WSL å­˜åœ¨å·²çŸ¥é—®é¢˜ï¼Œè¯¦æƒ…è¯·å‚é˜…å¸¸è§é—®é¢˜ç« èŠ‚ã€‚

## 1. å®‰è£… transhub

### 1.1. æ–¹å¼ä¸€ï¼šä½¿ç”¨ Linux è™šæ‹Ÿæœº/ä¸»æœºç›´æ¥å®‰è£… transhub

> â­**Windows ç³»ç»Ÿæ¨èä½¿ç”¨æ­¤æ–¹å¼**

#### 1.1.1 å®‰è£… Linux è™šæ‹Ÿæœºï¼ˆè‹¥ç›´æ¥ä½¿ç”¨ Linux ç‰©ç†æœºå¯è·³è¿‡æ­¤æ­¥ï¼‰

- ä¸‹è½½ VMware è½¯ä»¶

å‚è€ƒæ•™ç¨‹ï¼š

[VMware Workstation Pro 17 å®˜ç½‘ä¸‹è½½å®‰è£…æ•™ç¨‹\_vmware17pro ä¸‹è½½-CSDN åšå®¢](https://blog.csdn.net/air__j/article/details/142798842)

å®˜æ–¹ä¸‹è½½é“¾æ¥ï¼š

[https://support.broadcom.com/group/ecx/productdownloads?subfamily=VMware%20Workstation%20Pro](https://support.broadcom.com/group/ecx/productdownloads?subfamily=VMware%20Workstation%20Pro)

~~â­**å®˜æ–¹æ‰€æœ‰ç‰ˆæœ¬ä¸‹è½½é“¾æ¥ï¼ˆæ¨èï¼Œå®˜æ–¹æ¸ é“ä¸”æ— éœ€æ³¨å†Œè´¦æˆ·å¯ç›´æ¥ä¸‹è½½ï¼‰ï¼š**~~

~~[https://softwareupdate.vmware.com/cds/vmw-desktop/ws/](https://softwareupdate.vmware.com/cds/vmw-desktop/ws/)~~

ä¸Šè¿°é“¾æ¥å·²å¤±æ•ˆï¼Œå¯è®¿é—®ä»¥ä¸‹é“¾æ¥ä¸‹è½½ï¼š

[https://github.com/yanghao5/VM-download](https://github.com/yanghao5/VM-download)

ä¾‹å¦‚é€‰æ‹© 17.6.2 ç‰ˆæœ¬ï¼š

![image-20250603ä¸‹åˆ60521956](./images/image-20250603ä¸‹åˆ60521956.png)

- ä¸‹è½½ Ubuntu é•œåƒï¼ˆUbuntu18 æˆ– 20ã€22 ç­‰ç‰ˆæœ¬ï¼Œå¯æ ¹æ®è‡ªèº«éœ€æ±‚é€‰æ‹©ã€‚ç”±äº vscode é™åˆ¶ï¼Œè¾ƒè€çš„ç³»ç»Ÿç‰ˆæœ¬æ— æ³•ä½¿ç”¨ vscode è¿›è¡Œ ssh
  è¿œç¨‹è¿æ¥ï¼‰

[Index of /ubuntu-releases/18.04/ | æ¸…åå¤§å­¦å¼€æºè½¯ä»¶é•œåƒç«™ | Tsinghua Open Source Mirror](https://mirrors.tuna.tsinghua.edu.cn/ubuntu-releases/18.04/)

![image-20250603ä¸‹åˆ60604839](./images/image-20250603ä¸‹åˆ60604839.png)

- ä½¿ç”¨ VMware åˆ›å»º Ubuntu è™šæ‹Ÿæœº

#### 1.1.2. å®‰è£… Mahimahi

- åœ¨å…¶ç»ˆç«¯ä¸­è¿è¡Œå¦‚ä¸‹ä»£ç ï¼Œå®‰è£…ä¾èµ–é¡¹ï¼š

```bash
sudo apt-get install build-essential git debhelper autotools-dev dh-autoreconf iptables protobuf-compiler libprotobuf-dev pkg-config libssl-dev dnsmasq-base ssl-cert libxcb-present-dev libcairo2-dev libpango1.0-dev iproute2 apache2-dev apache2-bin iptables dnsmasq-base gnuplot iproute2 apache2-api-20120211 libwww-perl
```

ï¼ˆè¿™äº›ä¾èµ–é¡¹åœ¨[mahimahi / debian / control](https://github.com/keithw/mahimahi/blob/master/debian/control#L5)
ä¸­åˆ—å‡ºï¼Œå¦å¤–è¿˜æœ‰ä¸€äº›ç”¨äºæ¯”èµ›çš„ä¾èµ–é¡¹ï¼‰

- ä¸‹è½½ mahimahi æºä»£ç 

```bash
git clone https://github.com/ravinet/mahimahi
```

ï¼ˆMahimahi å·¥å…·æä¾›äº†æˆ‘ä»¬æ¨¡æ‹Ÿçš„èœ‚çªç½‘ç»œå’Œæµ‹é‡å·¥å…·ï¼‰

- ç¼–è¯‘å¹¶å®‰è£… mahimahi

```bash
cd mahimahi

# ï¼ˆç”¨makeå·¥å…·ç¼–è¯‘mahimahiï¼‰
./autogen.sh && ./configure && make

# å®‰è£…
sudo make install
sudo sysctl -w net.ipv4.ip_forward=1
# è¿›å…¥mahimahi
mm-delay 20
# é€€å‡ºmahimahi
exit
```

ï¼ˆè‹¥è¦æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸï¼Œå¯è¿è¡Œ `mm_delay 20`ï¼Œè‹¥å‡ºç° delay 20ms å­—æ ·ï¼Œè¯´æ˜å®‰è£…æˆåŠŸï¼‰

![image-20250603ä¸‹åˆ60750174](./images/image-20250603ä¸‹åˆ60750174.png)

#### 1.1.3. ç¼–è¯‘ Transhub ä»£ç 

```bash
#é€€å‡ºmahimahiç›®å½•ï¼Œå›åˆ°ç”¨æˆ·ç›®å½•
cd ..
#ä¸‹è½½transhubä»£ç 
git clone https://git.ruc.edu.cn/akth/cc-training
cd cc-training
#æŒ‰å¸¸è§„æ–¹å¼ç¼–è¯‘ä»£ç 
./autogen.sh && ./configure && make
```

### 1.2. æ–¹å¼äºŒï¼šä½¿ç”¨å·²å®‰è£…å¥½ Transhub çš„ Docker é•œåƒ

> â­**MacOS ç³»ç»Ÿæ¨èä½¿ç”¨æ­¤æ–¹å¼**

> 1.2.1 éƒ¨åˆ†ä»…é™ Macï¼ŒLinux/Windows å¹³å°å‚ç…§å¯¹åº”æ•™ç¨‹å®‰è£…å¥½ Docker åï¼Œåç»­æ–¹æ³•ï¼ˆ1.2.2-1.2.4ï¼‰é€šç”¨ã€‚

#### 1.2.1. å®‰è£… Docker

Linux ä¸Šå¦‚ä½•å®‰è£…ä½¿ç”¨ Docker è¯·è‡ªè¡ŒæŸ¥è¯¢ç›¸å…³æ•™ç¨‹ï¼Œæ­¤å¤„ä»¥ Mac å®‰è£… Docker ä¸ºä¾‹ã€‚

â—ï¸ å®æµ‹ Windows ä½¿ç”¨ Docker æ— æ³•æ­£å¸¸è¿è¡Œå®éªŒï¼Œè¯·æŸ¥çœ‹å¸¸è§é—®é¢˜ç« èŠ‚ã€‚

Mac ä¸Šå¯å®‰è£… Docker Desktop æˆ–è€… Orbstackï¼Œè¿™é‡Œä»¥ Orbstack ä¸ºä¾‹ã€‚

> OrbStack æ˜¯ä¸€æ¬¾ä¸“ä¸º MacOS è®¾è®¡çš„è½»é‡çº§å®¹å™¨å’Œè™šæ‹Ÿæœºç®¡ç†å·¥å…·ï¼Œæ—¨åœ¨ä¸ºå¼€å‘è€…æä¾›å¿«é€Ÿã€é«˜æ•ˆçš„å®¹å™¨åŒ–å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒã€‚å®ƒæ”¯æŒ
> Docker å®¹å™¨å’Œ Linux è™šæ‹Ÿæœºï¼Œç‰¹åˆ«é’ˆå¯¹ Apple Siliconï¼ˆM1/M2 ç­‰ ARM èŠ¯ç‰‡ï¼‰è¿›è¡Œäº†ä¼˜åŒ–ï¼Œèƒ½å¤Ÿæ— ç¼è¿è¡Œ x86 å’Œ ARM æ¶æ„çš„å®¹å™¨ã€‚

è®¿é—®[https://orbstack.dev/download](https://orbstack.dev/download)ä¸‹è½½å¹¶å®‰è£…ã€‚å®‰è£…å¥½åï¼Œæ‰“å¼€ Orbstack å®Œæˆåˆå§‹åŒ–ã€‚

#### 1.2.2. ä¸‹è½½å¹¶**å¯¼å…¥ Transhub é•œåƒ**

è®¿é—®ä»¥ä¸‹é“¾æ¥ä¸‹è½½å·²é…ç½®å¥½çš„ transhub é•œåƒï¼š

- ç™¾åº¦ç½‘ç›˜ï¼šé€šè¿‡ç½‘ç›˜åˆ†äº«çš„æ–‡ä»¶ï¼štranshub.tar.zip
  é“¾æ¥: [https://pan.baidu.com/s/1Lkx7VVvNTCAVaBJozT-8Lg?pwd=wnxf](https://pan.baidu.com/s/1Lkx7VVvNTCAVaBJozT-8Lg?pwd=wnxf)
  æå–ç : wnxf

åœ¨**é•œåƒæ‰€åœ¨ç›®å½•**è¿è¡Œç»ˆç«¯ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯¼å…¥ transhub é•œåƒ

```bash
docker load -i transhub.tar
```

å¯¼å…¥æˆåŠŸåï¼Œå¯ä»¥åœ¨ Orbstack çœ‹åˆ°è¯¥é•œåƒï¼š

![image-20250603ä¸‹åˆ60904876](./images/image-20250603ä¸‹åˆ60904876.png)

#### 1.2.3. åˆ›å»ºå¹¶è¿è¡Œ Transhub å®¹å™¨

æ­¤æ­¥éª¤**ä»…éœ€æ‰§è¡Œä¸€æ¬¡**ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºå¹¶è¿è¡Œ transhub å®¹å™¨ï¼š

```bash
sudo docker run --platform linux/amd64 --privileged -itd --name transhub transhub:v2.0
```

â— æ³¨æ„ï¼Œåœ¨ m èŠ¯ç‰‡ mac ä¸Šï¼Œéœ€è¦æ˜¾å¼æŒ‡å®šå¹³å°ä¸º `linux/amd64`ï¼Œå¼ºåˆ¶è¿è¡Œ x86 æ¶æ„çš„é•œåƒ

â— æ³¨æ„ï¼Œå¦‚éœ€è¦ä½¿ç”¨ `-v`å‘½ä»¤å°†ä¸»æœºä¸Šçš„ç›®å½•æŒ‚è½½åˆ°å®¹å™¨ç›®å½•ï¼Œè¯·å‹¿è¦†ç›–å®¹å™¨å†…çš„ `/home/none_root/transhub`
ç›®å½•ã€‚å› ä¸ºè¯¥ç›®å½•ä¸‹å·²åŒ…å«é…ç½®å¥½çš„ä»£ç æ–‡ä»¶ï¼Œå¦‚æ˜ å°„åï¼Œå°†è¢«ä¸»æœºç›®å½•è¦†ç›–ã€‚å³å¦‚éœ€ä½¿ç”¨
` -v ~/Downloads/transhub:/home/none_root/transhub`ï¼Œ`:`åä¸å¾—æ¥ `/home/none_root/transhub`

è¿è¡ŒæˆåŠŸåï¼Œå¯ä»¥åœ¨ Orbstack ä¸­çœ‹åˆ°å…¶å·²å¤„äºè¿è¡ŒçŠ¶æ€ï¼š

![image-20250603ä¸‹åˆ60938646](./images/image-20250603ä¸‹åˆ60938646.png)

#### 1.2.4. è¿›å…¥ Transhub å®¹å™¨

- é¦–å…ˆï¼Œç¡®ä¿å®¹å™¨å·²ç»å¯åŠ¨å¹¶æ­£åœ¨è¿è¡Œã€‚åœ¨æ‰§è¡Œå®Œ 2.3 æ­¥åï¼Œå®¹å™¨å·²ç»å¤„äºè¿è¡ŒçŠ¶æ€ã€‚åç»­è‹¥éœ€å†æ¬¡ä½¿ç”¨å®¹å™¨ï¼Œåˆ™æ— éœ€å†é‡å¤æ‰§è¡Œ 2.3
  æ­¥éª¤ï¼Œå¯ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æ¥å¯åŠ¨å®¹å™¨ã€‚

> `docker run`å‘½ä»¤é€šå¸¸ç”¨äºç¬¬ä¸€æ¬¡å¯åŠ¨ä¸€ä¸ªæ–°çš„å®¹å™¨ã€‚å½“ä½ æ‰§è¡Œ `docker run` æ—¶ï¼ŒDocker ä¼šæ‰§è¡Œä¸¤ä¸ªæ­¥éª¤ï¼šé¦–å…ˆï¼Œå®ƒä¼šä»æŒ‡å®šçš„é•œåƒåˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨ï¼ˆç›¸å½“äºæ‰§è¡Œäº†
`docker create` å‘½ä»¤ï¼‰ï¼Œç„¶åå®ƒä¼šå¯åŠ¨è¿™ä¸ªå®¹å™¨ï¼Œä½¿å…¶å˜æˆä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨ï¼ˆè¿™ä¸€æ­¥ç›¸å½“äºæ‰§è¡Œäº† `docker start`å‘½ä»¤ï¼‰ã€‚å› æ­¤ï¼Œ
`docker run` æ˜¯ä¸€ä¸ªç»„åˆå‘½ä»¤ï¼Œå®ƒä¸ä»…åˆ›å»ºå®¹å™¨ï¼Œè¿˜ä¼šç«‹å³å¯åŠ¨å®¹å™¨ã€‚å¦‚æœåœ¨ç³»ç»Ÿä¸Šæ‰¾ä¸åˆ°æŒ‡å®šçš„é•œåƒï¼Œ`docker run` ç”šè‡³ä¼šå°è¯•ä»
> Docker Hub æ‹‰å–é•œåƒã€‚
> ç›¸æ¯”ä¹‹ä¸‹ï¼Œ`docker start` å‘½ä»¤ç”¨äºå¯åŠ¨ä¸€ä¸ªå·²ç»å­˜åœ¨çš„å®¹å™¨ã€‚å¦‚æœä½ ä¹‹å‰å·²ç»åˆ›å»ºäº†ä¸€ä¸ªå®¹å™¨ï¼ˆæ— è®ºæ˜¯é€šè¿‡ `docker create`
> åˆ›å»ºçš„ï¼Œè¿˜æ˜¯ä¹‹å‰ç”¨ `docker run` åˆ›å»ºå¹¶å¯åŠ¨è¿‡çš„ï¼‰ï¼Œä½ å¯ä»¥ä½¿ç”¨ `docker start` æ¥é‡æ–°å¯åŠ¨è¿™ä¸ªå®¹å™¨ã€‚è¿™æ„å‘³ç€ï¼Œä½¿ç”¨
`docker start`
> æ—¶ï¼Œä½ å¿…é¡»çŸ¥é“è¦å¯åŠ¨çš„å®¹å™¨çš„ ID æˆ–åç§°ã€‚

å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å®¹å™¨çŠ¶æ€ï¼š

```bash
docker ps
```

å¦‚æœå®¹å™¨æ­£åœ¨è¿è¡Œï¼Œä½ ä¼šçœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„è¾“å‡ºï¼š

```bash
CONTAINER ID   IMAGE           COMMAND       CREATED       STATUS       PORTS     NAMES
eecfe24288b1   transhub:v2.0   "/bin/bash"   5 minutes ago Up 5 minutes          transhub
```

å¦‚æœå®¹å™¨æ²¡æœ‰è¿è¡Œï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨å®ƒï¼š

```bash
docker start transhub
```

- ä½¿ç”¨ `docker exec` å‘½ä»¤è¿›å…¥å®¹å™¨çš„ Shellï¼Œåç»­å³å¯åœ¨ç»ˆç«¯ä¸­**æ“ä½œè¯¥å®¹å™¨**

```bash
docker exec -it transhub /bin/bash
```

- æ¥ä¸‹æ¥å¯è¿›å…¥å®¹å™¨çš„ç›®å½• `/home/none_root/transhub`ï¼Œå¦‚æœä¸€åˆ‡æ— è¯¯ï¼Œä½ åº”è¯¥å¯ä»¥çœ‹åˆ°å·²å®‰è£…å¥½çš„ mahimahi å’Œ transhub æ–‡ä»¶ï¼š

```bash
cd home/none_root/transhub/
ls
```

![image-20250603ä¸‹åˆ61010718](./images/image-20250603ä¸‹åˆ61010718.png)

## 2. è¿è¡Œå®éªŒæµ‹è¯•

è¿è¡Œ `run-contest`å¼€å§‹æµ‹è¯•åï¼Œç¨‹åºå°†æ¨¡æ‹Ÿ VerizonLTE è¿æ¥å¤§çº¦ä¸¤åˆ†é’Ÿï¼Œè¯·è€å¿ƒç­‰å¾…ï¼Œè¿è¡Œå®Œæˆæ—¶ä¼šç”Ÿæˆæ—¥å¿—ã€‚

ğŸ’¡`run-contest`å·¥å…·è´Ÿè´£å°†æµ‹è¯•æ–‡ä»¶é€šè¿‡æ¨¡æ‹Ÿ Verizon downlink ç”Ÿæˆæ—¥å¿—ï¼Œå¹¶ä½¿ç”¨ mahimahi ä»¿çœŸï¼Œæä¾›ä¼ è¾“è¿‡ç¨‹ä¸­çš„æ€§èƒ½ä¿¡æ¯ï¼Œå¹¶æ˜¾ç¤º
queueing delay å’Œ throughput éšæ—¶é—´å˜åŒ–çš„æŠ˜çº¿å›¾ã€‚

### 2.1. é€šè¿‡æ–¹å¼ä¸€å®‰è£…çš„æµ‹è¯•è¿‡ç¨‹

- è¿è¡Œ `run-contest`å¼€å§‹å®éªŒ

```bash
sudo sysctl -w net.ipv4.ip_forward=1 #ï¼ˆå¿…é¡»å¯ç”¨Linuxçš„IPè½¬å‘æ‰èƒ½ä½¿mahimahiå·¥ä½œï¼‰
cd datagrump #ï¼ˆå‰æå·²ç»åœ¨cc-trainingç›®å½•ä¸‹ï¼‰
./run-contest [scheme_name] #ï¼ˆscheme_nameå°±æ˜¯ä½ ç»™è‡ªå·±æ–‡ä»¶å‘½åçš„åç§°ï¼Œç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶å¯ä»¥å°†[scheme_name] æ›¿æ¢ä¸ºcontroller.ccï¼‰
```

![image-20250603ä¸‹åˆ61050716](./images/image-20250603ä¸‹åˆ61050716.png)

- ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è·å–å®éªŒç»“æœ

```bash
mm-throughput-graph  500  ./contest_uplink_log > a.svg #ï¼ˆåˆ†ææ—¥å¿—ï¼Œè¾“å‡ºååç­‰ä¿¡æ¯,å¾—åˆ°svgå›¾ï¼‰

# å¾—åˆ°ä»¥ä¸‹ç»“æœ
Average capacity:å¹³å‡å®¹é‡
Average throughput:å¹³å‡ååé‡
95(th) percentile per-packet queueing delay:95%æ’é˜Ÿå»¶è¿Ÿ
95(th) percentile signal delay:95%ä¿¡å·å»¶è¿Ÿ
```

![image-20250603ä¸‹åˆ61131069](./images/image-20250603ä¸‹åˆ61131069.png)

![image-20250603ä¸‹åˆ61146187](./images/image-20250603ä¸‹åˆ61146187.png)

### 2.2. é€šè¿‡æ–¹å¼äºŒå®‰è£…çš„æµ‹è¯•è¿‡ç¨‹

â— æ³¨æ„ï¼Œåœ¨å®¹å™¨ä¸­è¿è¡Œæ—¶ï¼Œè¿è¡Œ `run-contest`éœ€è¦åœ¨é root ç”¨æˆ·ä¸‹æ‰§è¡Œï¼Œè€Œå¼€å¯ linux çš„ IP è½¬å‘ä»¥åŠç¼–è¯‘æºä»£ç éœ€è¦åœ¨ root ç”¨æˆ·ä¸‹ã€‚ä½¿ç”¨
`su none_root`åˆ‡æ¢ä¸ºé root ç”¨æˆ·ï¼Œä½¿ç”¨ `exit`åˆ‡æ¢å› root ç”¨æˆ·ã€‚åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­è¯·æ³¨æ„åœ¨ä¸¤ç§ç”¨æˆ·é—´çµæ´»åˆ‡æ¢ã€‚

- è¿è¡Œ `run-contest`å¼€å§‹å®éªŒ

```bash
sysctl -w net.ipv4.ip_forward=1 #ï¼ˆå¿…é¡»å¯ç”¨Linuxçš„IPè½¬å‘æ‰èƒ½ä½¿mahimahiå·¥ä½œï¼Œæ­¤æ“ä½œéœ€åœ¨rootç”¨æˆ·ä¸‹æ‰§è¡Œï¼‰
cd datagrump #ï¼ˆå‰æå·²ç»åœ¨cc-trainingç›®å½•ä¸‹ï¼‰
su none_root #ï¼ˆåˆ‡æ¢ä¸ºérootç”¨æˆ·ã€‚è‹¥æ˜¯æƒ³å†åˆ‡æ¢å›rootï¼Œåªéœ€è¦è¾“å…¥exitç„¶åæŒ‰ä¸‹å›è½¦å³å¯ï¼‰
./run-contest [scheme_name] #ï¼ˆscheme_nameå°±æ˜¯ä½ ç»™è‡ªå·±æ–‡ä»¶å‘½åçš„åç§°ï¼Œç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶å¯ä»¥å°†[scheme_name] æ›¿æ¢ä¸ºcontroller.ccï¼‰
```

æ‰§è¡Œå‘½ä»¤æ—¶ï¼Œè‹¥å¦‚ä¸‹æ–¹æç¤º `please run as non-root`ï¼Œè¯·ä½¿ç”¨å‘½ä»¤ `su none_root`åˆ‡æ¢åˆ° non_root ç”¨æˆ·ã€‚

```bash
root@12be595786c5:/home/none_root/transhub/cc-training/datagrump# ./run-contest  controller.cc
Listening on :::9090
Died on std::runtime_error: mm-delay: please run as non-root

 done.
```

ç”±é root ç”¨æˆ·åˆ‡æ¢å› root ç”¨æˆ·ç¤ºæ„å›¾ï¼š

![image-20250603ä¸‹åˆ61214104](./images/image-20250603ä¸‹åˆ61214104.png)

- ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è·å–å®éªŒç»“æœ

```bash
mm-throughput-graph  500  ./contest_uplink_log > a.svg #ï¼ˆåˆ†ææ—¥å¿—ï¼Œè¾“å‡ºååç­‰ä¿¡æ¯,å¾—åˆ°svgå›¾ï¼‰

# å¾—åˆ°ä»¥ä¸‹ç»“æœ
Average capacity:å¹³å‡å®¹é‡
Average throughput:å¹³å‡ååé‡
95(th) percentile per-packet queueing delay:95%æ’é˜Ÿå»¶è¿Ÿ
95(th) percentile signal delay:95%ä¿¡å·å»¶è¿Ÿ
```

![image-20250603ä¸‹åˆ61237420](./images/image-20250603ä¸‹åˆ61237420.png)

Mac å¯é€šè¿‡ä»¥ä¸‹æ–¹å¼æ‰¾åˆ°å®¹å™¨å†…æ–‡ä»¶ï¼š

![image-20250603ä¸‹åˆ61259332](./images/image-20250603ä¸‹åˆ61259332.png)

![image-20250603ä¸‹åˆ61315594](./images/image-20250603ä¸‹åˆ61315594.png)

ğŸ‰**Congratulationsï¼è‡³æ­¤ï¼Œä½ å·²æˆåŠŸå®‰è£… transhubï¼Œæ¥ä¸‹æ¥è¯·è®¾è®¡ä½ çš„ç®—æ³•ï¼Œå¹¶æäº¤éªŒè¯ï¼**

## 3. è¿›è¡Œç®—æ³•å¼€å‘

åœ¨ Ubuntu å†…å®‰è£… vscode æˆ–åœ¨å®¿ä¸»æœºä½¿ç”¨ vscode
è¿œç¨‹è¿æ¥åˆ°è™šæ‹Ÿæœºï¼ˆè¿æ¥æ–¹æ³•å¯æŸ¥çœ‹æ•™ç¨‹[è®© Visual studio code ä½¿ç”¨ SSH è¿æ¥è™šæ‹Ÿæœº Ubuntu å¼€å‘](https://zhuanlan.zhihu.com/p/681363165)
æˆ–æœç´¢å…³é”®è¯ `vscodeè¿æ¥è™šæ‹Ÿæœº`ï¼‰ã€‚

æ‰“å¼€ä»£ç ç›®å½•ï¼Œä¿®æ”¹ `controlle.cc`ä»£ç ï¼Œä¿®æ”¹å®Œæˆåï¼Œæ‰§è¡Œ `make`å‘½ä»¤ç¼–è¯‘ä»£ç ï¼Œç„¶åè¿è¡Œæµ‹è¯•éªŒè¯ä»£ç æ•ˆæœå³å¯ã€‚

å¦‚æœæ˜¯ä½¿ç”¨dockeræ–¹å¼å®‰è£…ï¼Œç”±äºdockeré•œåƒç³»ç»Ÿç‰ˆæœ¬è¾ƒä½ï¼Œæ— æ³•ä½¿ç”¨æœ€æ–°vscodeè¿›è¡Œè¿œç¨‹è¿æ¥ï¼ˆå¼¹å‡ºå¦‚ä¸‹æç¤ºï¼‰ï¼Œå¯ä»¥é€šè¿‡ç›®å½•æ˜ å°„å°†dockerå®¹å™¨å†…ç›®å½•æ˜ å°„åˆ°å®¿ä¸»æœºä¸Šè¿›è¡Œå¼€å‘ã€‚

å¯¹äº Mac ç”¨æˆ·ï¼ŒOrbstacké»˜è®¤è¿›è¡Œäº†ç›®å½•æŒ‚è½½ï¼Œå¯åœ¨vscodeä¸­ç›´æ¥æ‰“å¼€ç›®å½• `~/OrbStack/docker/containers/transhub/home/none_root`

![image_2025-07-10_17-58-05](./images/image_2025-07-10_17-58-05.png)

## 4. ç³»ç»Ÿæ‹¥å¡æ§åˆ¶ç®—æ³•é…ç½®ï¼ˆå¯é€‰ï¼‰

æœ¬èŠ‚å†…å®¹ä»‹ç»äº†å¦‚ä½•æŸ¥çœ‹å¹¶ä¿®æ”¹ç³»ç»Ÿæ‹¥å¡æ§åˆ¶ç®—æ³•ï¼Œå±äº**æ‹“å±•é˜…è¯»**éƒ¨åˆ†ã€‚

Linux ç³»ç»Ÿä¸­å¯é€‰çš„æ‹¥å¡æ§åˆ¶ç®—æ³•åŒ…æ‹¬ `reno`ã€`cubic`ã€`bbr`ç­‰ã€‚æœ¬èŠ‚ä»¥é…ç½® `bbr`ç®—æ³•ä¸ºä¾‹ï¼š

â— é…ç½®ä¸åŒçš„æ‹¥å¡æ§åˆ¶ç®—æ³•ä¼šå¯¹ä¼ è¾“ç»“æœäº§ç”Ÿä¸åŒçš„å½±å“ï¼Œå¯åšç›¸å…³å®éªŒéªŒè¯ï¼ˆæ­¤å¤„æ‰€æŒ‡**å®éªŒå¹¶é**æœ¬ transhub ä¸­çš„ `run-contest`
å®éªŒï¼Œ`run-contest`çš„æ‹¥å¡æ§åˆ¶ç®—æ³•ä¸º `controller.cc`,ä¸ç³»ç»Ÿæ‹¥å¡æ§åˆ¶ç®—æ³•æ— å…³ã€‚å¦‚éœ€éªŒè¯ç³»ç»Ÿæ‹¥å¡æ§åˆ¶ç®—æ³•ï¼Œå¯ä½¿ç”¨ `iperf`
ç­‰å·¥å…·æ¥åšç›¸å…³å®éªŒï¼‰ã€‚

### 4.1. é€šè¿‡æ–¹å¼ä¸€å®‰è£…çš„æ“ä½œè¿‡ç¨‹

ğŸ’¡ åœ¨ Linux ä¸»æœºä¸Šå¯ç”¨ BBR ç®—æ³•

```bash
# æŸ¥çœ‹ç³»ç»Ÿæ”¯æŒçš„æ‹¥å¡æ§åˆ¶ç®—æ³•
sudo sysctl net.ipv4.tcp_available_congestion_control
# è¾“å‡ºç»“æœï¼šè¡¨æ˜å½“å‰ç³»ç»Ÿæ”¯æŒreno cubicç®—æ³•
# net.ipv4.tcp_available_congestion_control = reno cubic

# æŸ¥çœ‹ç³»ç»Ÿå½“å‰ä½¿ç”¨çš„æ‹¥å¡æ§åˆ¶ç®—æ³•
sudo sysctl net.ipv4.tcp_congestion_control
# è¾“å‡ºç»“æœï¼šè¡¨æ˜å½“å‰ç³»ç»Ÿä½¿ç”¨cubicç®—æ³•
# net.ipv4.tcp_congestion_control = cubic

# åˆ‡æ¢åˆ°BBR
sudo sysctl net.core.default_qdisc=fq
sudo sysctl net.ipv4.tcp_congestion_control=bbr
# æŸ¥çœ‹æ˜¯å¦åˆ‡æ¢æˆåŠŸ
sudo sysctl net.ipv4.tcp_congestion_control

# åˆ‡æ¢å›CUBIC
sudo sysctl net.core.default_qdisc=pfifo
sudo sysctl net.ipv4.tcp_congestion_control=cubic
# æŸ¥çœ‹æ˜¯å¦åˆ‡æ¢æˆåŠŸ
sudo sysctl net.ipv4.tcp_congestion_control
```

### 4.2. é€šè¿‡æ–¹å¼äºŒå®‰è£…çš„æ“ä½œè¿‡ç¨‹

ğŸ’¡ åœ¨ Docker å®¹å™¨ä¸­å¯ç”¨ BBR ç®—æ³•

**é™„ç›¸å…³çŸ¥è¯†ç‚¹ï¼šDocker å®¹å™¨å…±äº«ä¸»æœºå†…æ ¸**ï¼š

- Docker å®¹å™¨å…±äº«å®¿ä¸»æœºçš„å†…æ ¸ï¼Œå› æ­¤å®¹å™¨å†…çš„ç½‘ç»œé…ç½®ï¼ˆå¦‚æ‹¥å¡æ§åˆ¶ç®—æ³•ï¼‰å—å®¿ä¸»æœºå†…æ ¸é™åˆ¶ã€‚
- å¦‚æœå®¿ä¸»æœºå†…æ ¸ä¸æ”¯æŒ BBRï¼Œå®¹å™¨å†…ä¹Ÿæ— æ³•ä½¿ç”¨ BBRã€‚

> Dockeråœ¨macOSä¸Šå’ŒWindowsä¸Šè·‘Linux dockeréƒ½æ˜¯å…ˆå¥—äº†ä¸ªè™šæ‹Ÿæœºï¼Œè™šæ‹Ÿæœºé‡Œè·‘Linuxæä¾›kernelï¼Œå†åœ¨é‡Œé¢è·‘dockerã€‚ä¾‹å¦‚ç›®å‰è™šæ‹Ÿæœºåœ¨Windowsä¸Šæ˜¯Hyper-Væˆ–è€…WSLã€‚

**æ‹¥å¡æ§åˆ¶ç®—æ³•**å±äº**å†…æ ¸ç®—æ³•**ï¼Œæ‰€ä»¥åœ¨ Docker å®¹å™¨èƒ½å¤Ÿä½¿ç”¨çš„æ‹¥å¡æ§åˆ¶ç®—æ³•å—**å®¿ä¸»æœºå†…æ ¸**ç¡®å®šã€‚bbrç®—æ³•æ˜¯è¾ƒæ–°çš„ç®—æ³•ï¼Œå¹¶éåœ¨æ‰€æœ‰å†…æ ¸éƒ½æ”¯æŒã€‚

ä½¿ç”¨å‘½ä»¤ `sysctl net.ipv4.tcp_available_congestion_control`æŸ¥çœ‹å½“å‰æ”¯æŒçš„æ‹¥å¡æ§åˆ¶ç®—æ³•ï¼š

```bash
# æŸ¥çœ‹ç³»ç»Ÿæ”¯æŒçš„æ‹¥å¡æ§åˆ¶ç®—æ³•
sysctl net.ipv4.tcp_available_congestion_control
# è¾“å‡ºç»“æœï¼šè¡¨æ˜å½“å‰ç³»ç»Ÿæ”¯æŒreno cubicç®—æ³•
# net.ipv4.tcp_available_congestion_control = reno cubic
```

- å¦‚æ˜¯ Linux å®¿ä¸»æœºï¼Œå¯æŒ‰ç…§ 3.1 èŠ‚æ–¹æ³•å¼€å¯å®¿ä¸»æœº bbr ç®—æ³•ï¼Œåœ¨å®¹å™¨ä¸­ä¹Ÿå°†å˜æ›´ä¸º bbr ç®—æ³•ã€‚
- Mac è‹¥æ˜¯ä½¿ç”¨ Orbstack çš„å®¹å™¨ï¼Œå¯å°è¯•ä½¿ç”¨ reno æˆ– cubic ç®—æ³•ã€‚ç›®å‰æš‚æ—¶æ²¡æ‰¾åˆ°æ‰“å¼€ bbr çš„æ–¹æ³•ï¼Œå› ä¸ºå®¹å™¨å†…å¼€å¯ bbr ç®—æ³•éœ€è¦**å®¿ä¸»æœºå†…æ ¸**æ”¯æŒã€‚è€Œåœ¨ Orbstack ä¸­ï¼Œè¯¥å†…æ ¸å®é™…ä¸Šæ˜¯ç”± Orbstack æä¾›çš„**å®šåˆ¶åŒ–çš„å†…ç½® Linux å†…æ ¸**ï¼Œç”¨æˆ·æ— æ³•ä¿®æ”¹ã€‚
- Windows Docker è‹¥æ˜¯ä½¿ç”¨ WSL åç«¯ï¼Œæš‚æ—¶ä¸æ”¯æŒè¯¥æ“ä½œã€‚

åœ¨ Docker ä¸­åˆ‡æ¢æ‹¥å¡æ§åˆ¶ç®—æ³•çš„å‘½ä»¤å¦‚ä¸‹ï¼š

```bash
# æŸ¥çœ‹ç³»ç»Ÿæ”¯æŒçš„æ‹¥å¡æ§åˆ¶ç®—æ³•
sysctl net.ipv4.tcp_available_congestion_control
# è¾“å‡ºç»“æœï¼šè¡¨æ˜å½“å‰ç³»ç»Ÿæ”¯æŒreno cubicç®—æ³•
# net.ipv4.tcp_available_congestion_control = reno cubic

# æŸ¥çœ‹ç³»ç»Ÿå½“å‰ä½¿ç”¨çš„æ‹¥å¡æ§åˆ¶ç®—æ³•
sysctl net.ipv4.tcp_congestion_control
# è¾“å‡ºç»“æœï¼šè¡¨æ˜å½“å‰ç³»ç»Ÿä½¿ç”¨cubicç®—æ³•
# net.ipv4.tcp_congestion_control = cubic

#===========è‹¥å†…æ ¸æ”¯æŒBBRï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ‡æ¢åˆ°BBRä»¥åŠåˆ‡å›CUBIC
# åˆ‡æ¢åˆ°BBR
sysctl net.core.default_qdisc=fq
sysctl net.ipv4.tcp_congestion_control=bbr
# æŸ¥çœ‹æ˜¯å¦åˆ‡æ¢æˆåŠŸ
sysctl net.ipv4.tcp_congestion_control

# åˆ‡æ¢å›CUBIC
sudo sysctl net.core.default_qdisc=pfifo
sudo sysctl net.ipv4.tcp_congestion_control=cubic
# æŸ¥çœ‹æ˜¯å¦åˆ‡æ¢æˆåŠŸ
sudo sysctl net.ipv4.tcp_congestion_control

#===========è‹¥å†…æ ¸ä¸æ”¯æŒBBRï¼Œä¾‹å¦‚ä½¿ç”¨Orbstackï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ‡æ¢åˆ°RENOä»¥åŠåˆ‡å›CUBIC
# åˆ‡æ¢åˆ°RENO
sysctl net.ipv4.tcp_congestion_control=reno

# åˆ‡æ¢åˆ°CUBIC
sysctl net.ipv4.tcp_congestion_control=cubic
```

![image-20250603ä¸‹åˆ61359463](./images/image-20250603ä¸‹åˆ61359463.png)



# å¸¸è§é—®é¢˜

## 1. ç«èµ›å¹³å°é—®é¢˜

### 1.1. ç«èµ›å¹³å°æ—¥å¿—ä¸­æ˜¾ç¤º`terminate called after throwing an instance of 'unix_error'`

æ­¤æ—¥å¿—ä¸ºæ­£å¸¸ç°è±¡ï¼Œåªè¦æ˜¾ç¤ºçš„è¯„æµ‹æ—¶é—´æ­£ç¡®å³å¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![log_error](./images/log_error.png)



## 2. Transhubå®‰è£…é—®é¢˜

### 2.1. Ubuntu24 ç‰ˆæœ¬é»˜è®¤å®‰è£… gnuplot 6.0 å¯¼è‡´æ— æ³•æ­£ç¡®ç»˜åˆ¶æµé‡å›¾

å¯¹äº Ubuntu 24 ç‰ˆæœ¬ï¼Œå¯èƒ½é»˜è®¤å®‰è£…çš„ gnuplot ä¸º 6.0 ç‰ˆæœ¬ï¼Œå°†å¯¼è‡´åç»­ç»˜åˆ¶æµé‡å›¾æ—¶å‡ºé”™ï¼ˆç»˜åˆ¶çš„æµé‡å›¾æ— æ³•æ­£å¸¸æ‰“å¼€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰ï¼Œéœ€è¦å°†
gnuplot é™çº§åˆ° 5.4ï¼ŒUbuntu 22 åŠä»¥ä¸‹ç‰ˆæœ¬é»˜è®¤å®‰è£…çš„æ˜¯ 5.4 ç‰ˆæœ¬ï¼Œä¸ä¼šæœ‰æ­¤é—®é¢˜ã€‚

![svg_error](./images/svg_error.png)

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤é™çº§åˆ° 5.4 ç‰ˆæœ¬

   ```sh
   # 1. å¸è½½å½“å‰ç‰ˆæœ¬
   sudo apt remove --purge gnuplot

   # 2. å®‰è£…ç¼–è¯‘ä¾èµ–
   sudo apt update
   sudo apt install build-essential libx11-dev libxt-dev libcairo2-dev libpango1.0-dev

   # 3. ä¸‹è½½5.4.0æºç åŒ…
   wget https://sourceforge.net/projects/gnuplot/files/gnuplot/5.4.0/gnuplot-5.4.0.tar.gz
   tar xvf gnuplot-5.4.0.tar.gz
   cd gnuplot-5.4.0

   # 4. ç¼–è¯‘å®‰è£…
   ./configure --prefix=/usr/local
   make -j$(nproc)
   sudo make install

   # 5. åˆ›å»ºç¬¦å·é“¾æ¥
   sudo ln -sf /usr/local/bin/gnuplot /usr/bin/gnuplot

   # 6. éªŒè¯ç‰ˆæœ¬
   gnuplot --version
   ```

### 2.2. Ubuntu20 ç‰ˆæœ¬ç”±äºé˜²ç«å¢™å¯¼è‡´æ— æ³•è¿è¡Œå®éªŒ

Ubuntu20ã€22 ç‰ˆæœ¬ä¹Ÿå¯æ­£å¸¸å®Œæˆ transhub å®‰è£…ï¼Œä½†åœ¨è¿è¡Œå®éªŒæ—¶ï¼Œéœ€è¦å…³é—­é˜²ç«å¢™ï¼Œå¦åˆ™å®éªŒè·‘ä¸é€šã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å…³é—­é˜²ç«å¢™ï¼š

   ```shell
   sudo ufw disable
   ```

### 2.3. WSL æ— æ³•æ­£å¸¸å®‰è£… transhub

æ ¹æ®å®æµ‹ï¼Œä½¿ç”¨ Windows WSL æ— æ³•æˆåŠŸå®‰è£… transhubï¼Œå› æ­¤ä¸å»ºè®®ä½¿ç”¨ WSL Dockerã€‚å¯¹äº Windows ç”¨æˆ·ï¼ŒåŒå­¦ä»¬å¯ä½¿ç”¨ Linux
è™šæ‹Ÿæœºç›´æ¥å®‰è£… transhub æˆ–è€…åœ¨ Linux è™šæ‹Ÿæœºä¸­ä½¿ç”¨ Dockerã€‚

### 2.4. ä¸¢åŒ…ç¯å¢ƒä¸‹ mm-throughput-graph æ— æ³•ç»˜åˆ¶

éœ€è¦ä¿®æ”¹ `/usr/local/bin/mm-throughput-graph` æ–‡ä»¶ä½¿å¾—è¯¥è„šæœ¬èƒ½å¯¹æœ‰ä¸¢åŒ…äº‹ä»¶çš„æ—¥å¿—è¿›è¡Œç”»å›¾æ“ä½œï¼Œå…·ä½“æ”¹åŠ¨å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆæ”¹åŠ¨ä¹‹å¤„ç”¨çº¢æ¡†æ ‡å‡ºï¼‰

![image-20250709214500](./images/image-20250709214500.png)

------

æœ¬æ–‡æ¡£æ›´æ–°æ—¶é—´ï¼š2025 å¹´ 07 æœˆ 11 æ—¥ æ˜ŸæœŸäº”
